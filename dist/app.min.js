var app=angular.module("CCApp",["ngRoute","ngAnimate"]);app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"./views/home.html",controller:"HomeCtrl"}).when("/countries",{templateUrl:"./views/countries.html",controller:"SearchCtrl"}).when("/countries/:country",{templateUrl:"./views/countryDetail.html",controller:"DeetsCtrl"}).when("/error",{templateUrl:"./views/error.html"}).otherwise("/error",{templateUrl:"./views/error.html"})}]),app.run(["$rootScope","$timeout","$location",function(a,b,c){a.$on("$routeChangeError",function(){c.path("/error")}),a.$on("$routeChangeStart",function(){"/"===c.path()?a.isLoading=!1:a.isLoading=!0}),a.$on("$routeChangeSuccess",function(){"/"!=c.path()&&b(function(){a.isLoading=!1},1500)})}]),app.factory("allCountryFacts",["$location","$http",function(a,b){function c(){return f}function d(a){for(var b=0;b<f.length;b++)f[b].countryName==a&&(g=f[b]);return g}var e="http://api.geonames.org/countryInfoJSON?username=dcaponi",f=[],g={};return b.get(e,{cache:!0}).then(function(a){for(var b=0;b<a.data.geonames.length;b++)f[b]=a.data.geonames[b];return f},function(a){console.error("Sorry bro, Error:"+a)}),{getCountries:c,getOneCountry:d}}]),app.factory("capitalFacts",["$location","$http",function(a,b){var c=function(a,c){var d={q:a.capital,country:a.countryCode,fcode:"pplc",username:"dcaponi"};return b({method:"GET",url:"http://api.geonames.org/searchJSON?username=dcaponi",cache:!0,params:d}).success(function(a){var b=a.geonames[0];c(b)}).error(function(a){console.error("Sorry bro, Error:"+status)})};return{getCapital:c}}]),app.factory("neighborsService",["$location","$http","$routeParams",function(a,b,c){var d=function(c,d){var e="http://api.geonames.org/neighboursJSON?geonameId="+c.geonameId+"&username=dcaponi";return b.get(e,{cache:!0}).then(function(a){var b=a.data.geonames;console.log(b),d(b)},function(b){console.error("Sorry bro, Error:"+b),a.path("countries/")})};return{getNeighbors:d}}]),app.controller("HomeCtrl",["$scope","$rootScope","$location","$timeout",function(a,b,c,d){console.log("HOME")}]),app.controller("SearchCtrl",["allCountryFacts","$scope","$rootScope","$location","$timeout",function(a,b,c,d,e){b.countries=a.getCountries(),b.toDetails=function(a){d.path("countries/"+a)}}]),app.controller("DeetsCtrl",["allCountryFacts","capitalFacts","neighborsService","$scope","$rootScope","$location","$timeout","$routeParams",function(a,b,c,d,e,f,g,h){d.singleCountry=a.getOneCountry(h.country);var b=b.getCapital(d.singleCountry,function(a){return d.capitalFacts=a,d.capitalFacts.flag="http://www.geonames.org/flags/x/"+d.capitalFacts.countryCode.toLowerCase()+".gif",d.capitalFacts.map="http://www.geonames.org/img/country/250/"+d.capitalFacts.countryCode+".png",d.capitalFacts});c.getNeighbors(d.singleCountry,function(a){d.neighbors=a});d.toDetails=function(a){f.path("countries/"+a)}}]);